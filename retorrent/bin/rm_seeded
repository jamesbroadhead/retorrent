#!/usr/bin/python
"""
Usage:
    rm_seeded TARGETS...

"""
import os
import sys

from docopt import docopt

from retorrentlib import seededlib
from retorrentlib.confparse import parse_retorrentconf
from retorrentlib.find_tfile import gen_map, tfile_from_filename
from retorrentlib.remreffer import remref

def main(targets):
    config, _ = parse_retorrentconf()
    seeddir = config['seeddir']
    seed_tfilesdir = config['seedtorrentfilesdir']
    assert seeddir is not None and seed_tfilesdir is not None

    targets = [ t for t in targets if os.path.exists(t) ]
    if not targets:
        print 'No extant targets!'
        sys.exit(1)

    seeded, unseeded = seededlib.is_seeded(targets, seeddir=seeddir)

    files_tfiles = gen_map(seed_tfilesdir)
    tfiles = [ tfile_from_filename(seedpath, files_tfiles)
               for videopath, seedpath in seeded.items() ]

    res = remref(unseeded + tfiles + seeded.keys() + seeded.values())

    print 'Remember: if there were dirs in seed/, they will remain!'

    return res

if __name__ == '__main__':
    arguments = docopt(__doc__)
    try:
        returncode = main(arguments['TARGETS'])
        sys.exit(returncode)
    except KeyboardInterrupt:
        pass
